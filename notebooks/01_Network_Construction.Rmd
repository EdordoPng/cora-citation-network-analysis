---
title: "01_Network_Construction"
author: "Edoardo Diana"
date: "2025-11-15"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

Dopo aver creato le cartelle, prosegui a scaricare il file del progetto
Se non va, prova ad eseguirlo direttamente da terminale.

```{r}
source("scripts/01_download_data.R")
```

# 01_Network_Construction.Rmd: 

Lettura, costruzione grafo e salvataggio

```{r setup, include=FALSE}

library(tidyverse)
library(igraph)
```

Inizio costruzione network da Cora

```{r}

# Percorsi dati
data_raw_dir <- "data/raw"
cora_content_file <- file.path(data_raw_dir, "cora.content")
cora_cites_file <- file.path(data_raw_dir, "cora.cites")

# --- Lettura cora.content ---
# File con: paper_id, 1434 feature binarie, 1 categoria

content_df <- read_delim(cora_content_file, delim = "\t", col_names = FALSE, trim_ws = TRUE)
colnames(content_df) <- c("paper_id", paste0("word", 1:1434), "category")

cat("Letti paper:", nrow(content_df), "\n")
cat("Categorie:", unique(content_df$category), "\n")

# --- Lettura cora.cites ---
# File con due colonne: [paper_cited, paper_citing]

cites_df <- read_delim(cora_cites_file, delim = "\t", col_names = FALSE)
colnames(cites_df) <- c("paper_cited", "paper_citing")

cat("Letti archi citazioni:", nrow(cites_df), "\n")

```

Costruzione grafo orientato igraph

```{r}

nodes <- content_df %>%
  select(paper_id, category)

edges <- cites_df %>%
  filter(paper_cited %in% nodes$paper_id & paper_citing %in% nodes$paper_id)

g <- graph_from_data_frame(d = edges, vertices = nodes, directed = TRUE)

cat("Nodi grafo:", vcount(g), "\n")
cat("Archi grafo:", ecount(g), "\n")

```

Costruzione matrice di citazioni normalizzata per categoria

```{r}

# Matrice 7x7 con conti di citazioni da categoria i a categoria j
cats <- unique(nodes$category)
n_cats <- length(cats)

# Crea mappa id -> category
cat_map <- setNames(nodes$category, nodes$paper_id)

# Aggrega conteggi per coppie di categorie
cat_count <- matrix(0, nrow = n_cats, ncol = n_cats)
rownames(cat_count) <- cats
colnames(cat_count) <- cats

for (i in 1:nrow(edges)) {
  from_cat <- cat_map[[as.character(edges$paper_citing[i])]]
  to_cat <- cat_map[[as.character(edges$paper_cited[i])]]
  if (!is.null(from_cat) && !is.null(to_cat)) {
    cat_count[from_cat, to_cat] <- cat_count[from_cat, to_cat] + 1
  }
}

# Normalizza righe in probabilitÃ 
cat_prob <- sweep(cat_count, 1, rowSums(cat_count), FUN = "/")

# --- Salvataggio oggetti per futuro uso ---

dir_processed <- "data/processed"
if (!dir.exists(dir_processed)) dir.create(dir_processed)

saveRDS(g, file = file.path(dir_processed, "network.rds"))
saveRDS(cat_prob, file = file.path(dir_processed, "citation_matrix.rds"))

cat("Salvati grafo e matrice citazioni in data/processed\n")

```

```{r}

```


```{r}

```


```{r}

```


```{r}

```


```{r}

```
